---
layout: post
title: "Installing Web Applications with Wix"
description: ""
category: 
tags: [Wix Installer, Visual Studio]
---
{% include JB/setup %}

Some comments and text go here.

{% highlight xml %}
 <Target Name="BeforeBuild">
    <!-- We'll go and get the Web Projects (marked with <PackageThisProject>True</PackageThisProject>)
        and we'll MSBuild them using the Package output to create something ready to be shipped to a web server,
        including web.config transforms. We'll then use heat.exe to harvest this output and drop a .wxs file in the \Components\
        folder where it can be included with DirectoryId="ProjectName_DIRECTORY" and "ComponentGroupId=ProjectName_PROJECT"
        *******************
        References:
        http://www.paraesthesia.com/archive/2010/07/30/how-to-consume-msdeploy-staged-web-site-output-in-a.aspx
        http://www.chrissurfleet.co.uk/post/2011/07/01/Using-Packaged-Project-Output-in-WiX-and-Visual-Studio.aspx
        http://stackoverflow.com/questions/10653930/wix-3-6-installer-visual-studio-2010-heatdirectory
        *******************
        -->
    <MSBuild Projects="%(ProjectReference.FullPath)" Targets="Package" Properties="Configuration=$(Configuration);Platform=AnyCPU" Condition="'%(ProjectReference.PackageThisProject)'=='True'" />
    <Copy SourceFiles="%(ProjectReference.RootDir)%(ProjectReference.Directory)obj\$(Configuration)\TransformWebConfig\transformed\web.config" OverwriteReadOnlyFiles="true" DestinationFolder="%(ProjectReference.RootDir)%(ProjectReference.Directory)obj\$(Configuration)\Package\PackageTmp\" Condition="'%(ProjectReference.PackageThisProject)'=='True'" />
    <PropertyGroup>
      <LinkerBaseInputPaths>%(ProjectReference.RootDir)%(ProjectReference.Directory)obj\$(Configuration)\Package\PackageTmp\</LinkerBaseInputPaths>
      <DefineConstants Condition="'%(ProjectReference.PackageThisProject)'=='True'">
        %(ProjectReference.Name).PackageDir=%(ProjectReference.RootDir)%(ProjectReference.Directory)obj\$(Configuration)\Package\PackageTmp\ </DefineConstants>
    </PropertyGroup>
    <Message Text="Constant defined: %(ProjectReference.Name).PackageDir"/>
    <HeatDirectory OutputFile=".\Components\%(ProjectReference.Filename).wxs" Directory="%(ProjectReference.RootDir)%(ProjectReference.Directory)obj\$(Configuration)\Package\PackageTmp\" DirectoryRefId="%(ProjectReference.Filename)_DIRECTORY" ComponentGroupName="%(ProjectReference.Filename)_PROJECT" SuppressCom="true" SuppressFragments="true" SuppressRegistry="true" SuppressRootDirectory="true" AutoGenerateGuids="false" GenerateGuidsNow="true" ToolPath="$(WixToolPath)" Condition="'%(ProjectReference.PackageThisProject)'=='True'" PreprocessorVariable="var.%(ProjectReference.Name).PackageDir" />
  </Target>
{% endhighlight %}